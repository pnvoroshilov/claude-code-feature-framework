# ClaudeTask Framework - Требования к разработке

## Общее описание
ClaudeTask - это локальный фреймворк для управления задачами разработки с интеграцией Claude Code через MCP протокол. Система позволяет вести задачи как в Jira, но с автоматической разработкой через Claude.

## Концепция использования
1. **Установка фреймворка** - один раз через Docker Compose
2. **Инициализация проекта** - подключение локальной папки с кодом
3. **Автоматическая настройка** - создание .claudetask/ с инструкциями
4. **Интеграция с Claude Code** - через MCP протокол
5. **Управление задачами** - через веб-интерфейс как в Jira
6. **Автоматическая разработка** - Claude выполняет задачи по workflow

## Технический стек
- **Frontend**: React + TypeScript + Material-UI
- **Backend**: Python FastAPI + SQLite
- **MCP Server**: Python-based MCP implementation
- **Containerization**: Docker + Docker Compose
- **VCS**: Git с worktree support

## Функциональные требования

### 1. Управление проектами

#### 1.1 Инициализация проекта
- Выбор локальной папки с проектом через UI
- Автоматическое создание `.mcp.json` в корне проекта для MCP конфигурации
- Автоматическое создание структуры `.claudetask/` в проекте:
  - `CLAUDE.md` - главные инструкции для Claude
  - `agents/` - копии субагентов из фреймворка
  - `project.json` - метаданные проекта
  - `templates/` - шаблоны для задач
- Создание папки `worktrees/` для изолированной разработки

#### 1.2 Управление проектами
- Поддержка множественных проектов (переключение в UI)
- Хранение истории задач для каждого проекта
- Возможность деинициализации (отключения) проекта
- Автоматическое определение технологий проекта

### 2. Управление задачами

#### 2.1 Типы задач
- Feature - новая функциональность
- Bug - исправление ошибок

#### 2.2 Поля задачи
- ID (автогенерируемый)
- Заголовок
- Описание (от пользователя)
- Тип (Feature/Bug)
- Приоритет (High/Medium/Low)
- Статус
- Анализ от Claude (заполняется автоматически)
- Git ветка (автогенерируется)
- Дата создания
- Дата обновления

#### 2.3 Workflow статусов
1. **Backlog** - новые задачи от пользователя
2. **Analysis** - Claude анализирует задачу
3. **Ready** - проанализировано, ожидает разработки
4. **In Progress** - в активной разработке
5. **Testing** - готово к тестированию
6. **Code Review** - проверка кода
7. **Done** - завершено и смержено в main

### 3. Интеграция с Claude Code через MCP

#### 3.1 MCP Server endpoints
```
/connection/verify - проверить подключение Claude к фреймворку
/tasks/next - получить следующую задачу по приоритету
/tasks/{id} - получить детали задачи
/tasks/{id}/analyze - запустить анализ задачи
/tasks/{id}/status - обновить статус
/tasks/{id}/analysis - сохранить результат анализа
/project/context - получить контекст проекта
/project/info - информация о текущем проекте
/worktree/create - создать git worktree для задачи
/worktree/cleanup - очистить worktree после мержа
```

#### 3.2 Автоматическое обнаружение Claude
- При запуске Claude Code в папке проекта
- Чтение `.claudetask/CLAUDE.md` автоматически
- Загрузка субагентов из `.claudetask/agents/`
- Подключение к MCP серверу по конфигурации

#### 3.3 Claude анализ задачи должен включать
- Список затрагиваемых файлов
- Точки входа для изменений
- Зависимости и связанные модули
- Потенциальные риски
- Edge cases
- Оценка сложности
- Рекомендуемый подход к реализации

### 4. Git интеграция

#### 4.1 Ветвление
- Автоматическое создание веток: `feature/{task-id}-{short-name}` или `bugfix/{task-id}-{short-name}`
- Использование git worktree для изоляции разработки
- Автоматическая очистка worktree после мержа

#### 4.2 GitHub интеграция
- Создание PR при переходе в Code Review
- Автоматическое заполнение описания PR из задачи
- Линковка PR с задачей

### 5. UI функциональность

#### 5.1 Экран инициализации проекта
- Выбор папки проекта (file picker или ввод пути)
- Автоматическое определение git репозитория
- Предпросмотр создаваемой структуры
- Кнопка "Initialize Project"
- Отображение инструкций для настройки MCP

#### 5.2 Основной экран - Kanban доска
- Колонки по статусам
- Drag-and-drop для смены статусов
- Цветовая индикация приоритетов
- Быстрый просмотр деталей задачи
- Индикатор активной задачи (которую выполняет Claude)

#### 5.3 Создание/редактирование задачи
- Модальное окно с формой
- Валидация полей
- Markdown поддержка в описании
- Отображение анализа от Claude (read-only)

#### 5.4 Панель конфигурации
- Редактор CLAUDE.md (с live preview)
- Управление субагентами (add/edit/delete)
- Настройки проекта (путь, git repo)
- Генератор MCP конфигурации для claude_desktop_config.json

#### 5.5 Панель статуса
- Индикатор подключения Claude
- Текущая активная задача
- Лог последних действий
- Статистика по задачам

### 6. Backend API

#### 6.1 Endpoints

##### Управление проектами
```
POST /api/project/initialize - инициализировать новый проект
GET /api/project/list - список всех проектов
GET /api/project/current - текущий активный проект
PUT /api/project/switch - переключить активный проект
DELETE /api/project/{id}/deinitialize - отключить проект
GET /api/project/settings - настройки проекта
PUT /api/project/settings - обновить настройки
GET /api/project/mcp-config - получить конфигурацию для MCP
```

##### Управление задачами
```
GET /api/tasks - список всех задач текущего проекта
POST /api/tasks - создать задачу
GET /api/tasks/{id} - получить задачу
PUT /api/tasks/{id} - обновить задачу
DELETE /api/tasks/{id} - удалить задачу
PUT /api/tasks/{id}/status - изменить статус
GET /api/tasks/{id}/history - история изменений задачи
```

##### Конфигурация Claude
```
GET /api/claude/config - получить CLAUDE.md текущего проекта
PUT /api/claude/config - обновить CLAUDE.md
GET /api/claude/connection - статус подключения Claude
GET /api/agents - список субагентов
POST /api/agents - создать субагента
PUT /api/agents/{id} - обновить субагента
DELETE /api/agents/{id} - удалить субагента
POST /api/agents/sync - синхронизировать агентов с проектом
```

### 7. Deployment

#### 7.1 Docker структура
```
claudetask/
  ├── frontend/          # React приложение
  ├── backend/           # FastAPI сервер
  ├── mcp-server/        # MCP интеграция
  ├── data/              # SQLite и конфигурации
  └── docker-compose.yml
```

#### 7.2 Порты
- Frontend: 3000
- Backend API: 8000
- MCP Server: 3333

### 8. Автоматизация процессов

#### 8.1 При инициализации проекта
1. Создание `.mcp.json` в корне проекта с MCP конфигурацией
2. Создание структуры `.claudetask/` в папке проекта
3. Копирование CLAUDE.md и агентов из фреймворка
4. Создание `project.json` с метаданными
5. Создание папки `worktrees/`
6. Сохранение существующих MCP серверов если `.mcp.json` уже существовал
7. Уведомление о необходимости перезапуска Claude Code

#### 8.2 При создании задачи
1. Сохранение в БД со статусом Backlog
2. Привязка к текущему проекту
3. Уведомление Claude если подключен

#### 8.3 При анализе (Analysis)
1. Claude получает контекст проекта через MCP
2. Анализирует кодовую базу проекта
3. Заполняет поле анализа
4. Переводит в Ready

#### 8.4 При разработке (In Progress)
1. Создание git worktree в папке проекта
2. Создание feature/bug ветки
3. Claude выполняет разработку
4. Коммит изменений

#### 8.5 При Code Review
1. Создание PR в GitHub
2. Claude проводит self-review
3. При одобрении - мерж в main
4. Очистка worktree

## Нефункциональные требования

### Производительность
- Отклик UI < 200ms
- Анализ задачи < 30 секунд
- Поддержка до 1000 задач

### Надежность
- Автосохранение изменений
- Graceful обработка ошибок MCP
- Резервное копирование SQLite

### Удобство использования
- Простая установка через docker-compose up
- Минимальная конфигурация
- Интуитивный UI
- Подробная документация

### Безопасность
- Все данные локальные
- Нет внешних зависимостей
- Нет передачи данных вовне
- Git credentials через SSH keys

## Ограничения
- Работа только локально
- Один пользователь
- Один активный проект
- Нет многопользовательской работы